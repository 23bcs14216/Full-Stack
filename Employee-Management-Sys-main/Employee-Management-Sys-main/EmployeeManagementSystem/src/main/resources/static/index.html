<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Employee Management - Simple UI</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial;max-width:1000px;margin:24px auto;padding:8px}
    h1{font-size:22px}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{border:1px solid #ddd;padding:8px;text-align:left}
    th{background:#f4f4f4}
    tr:nth-child(even){background:#fafafa}
    form{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    input[type=text], input[type=email], input[type=number]{padding:6px;border:1px solid #ccc;border-radius:4px}
    button{padding:8px 12px;border-radius:6px;border:0;background:#1f6feb;color:#fff;cursor:pointer}
    button.danger{background:#d9534f}
    button.secondary{background:#6c757d}
    .hidden{display:none}
    .controls{margin-top:12px;display:flex;gap:8px;flex-wrap:wrap}
    .note{color:#666;font-size:13px;margin-top:8px}
    .small{font-size:12px;color:#666}
  </style>
</head>
<body>
  <h1>Employee Management (Browser UI)</h1>

  <div>
    <form id="employeeForm" onsubmit="return onSubmit(event)">
      <!-- Visible ID field so user can enter an ID manually (optional) -->
      <input id="empId" type="number" placeholder="ID (mandatory)" />

      <input id="email" type="email" placeholder="Email" required />
      <input id="firstname" type="text" placeholder="First name (firstname)" required />
      <input id="lastname" type="text" placeholder="Last name (lastname)" />
      <div class="controls">
        <button id="saveBtn" type="submit">Save</button>
        <button id="cancelBtn" type="button" class="secondary hidden" onclick="resetForm()">Cancel</button>
        <button id="refreshBtn" type="button" class="secondary" onclick="loadEmployees()">Refresh</button>
      </div>
    </form>
    <div class="note">Tip: API expects fields <code>firstname</code> and <code>lastname</code> (lowercase). ID is optional â€” if provided it will be used as the primary key.</div>
  </div>

  <table id="employeesTable" aria-live="polite">
    <thead>
      <tr><th>ID</th><th>Email</th><th>First name</th><th>Last name</th><th>Actions</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const API_BASE = 'http://localhost:8080/api/employee';

    async function loadEmployees(){
      try{
        const res = await fetch(API_BASE);
        if (!res.ok) throw new Error('Failed to load: ' + res.status);
        const data = await res.json();
        renderTable(data || []);
      }catch(err){
        alert('Could not load employees: ' + err);
      }
    }

    function renderTable(items){
      const tbody = document.querySelector('#employeesTable tbody');
      tbody.innerHTML = '';
      if(items.length === 0){
        const tr = document.createElement('tr');
        tr.innerHTML = '<td colspan="5" style="text-align:center;color:#666">No employees found</td>';
        tbody.appendChild(tr);
        return;
      }
      items.forEach(emp=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${emp.id ?? ''}</td>
          <td>${escapeHtml(emp.email ?? '')}</td>
          <td>${escapeHtml(emp.firstname ?? '')}</td>
          <td>${escapeHtml(emp.lastname ?? '')}</td>
          <td>
            <button onclick="onEdit(${emp.id})">Edit</button>
            <button class="danger" onclick="onDelete(${emp.id})">Delete</button>
          </td>`;
        tbody.appendChild(tr);
      });
    }

    function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' })[c]); }

    async function onSubmit(e){
      e.preventDefault();
      // get id value (empty string if not provided)
      const idRaw = document.getElementById('empId').value;
      const id = idRaw ? parseInt(idRaw, 10) : null;
      const email = document.getElementById('email').value.trim();
      const firstname = document.getElementById('firstname').value.trim();
      const lastname = document.getElementById('lastname').value.trim();

      // Build body. Include id if provided (so backend receives it).
      const body = id !== null ? { id, email, firstname, lastname } : { email, firstname, lastname };

      try{
        let res;
        // Determine whether we are editing (cancel button visible) or creating
        const isEditing = !document.getElementById('cancelBtn').classList.contains('hidden');

        if (isEditing && id !== null) {
          // Update existing record via PUT to /api/employee/{id}
          res = await fetch(`${API_BASE}/${id}`, {
            method: 'PUT',
            headers: {'Content-Type':'application/json'},
            body: JSON.stringify({ email, firstname, lastname })
          });
        } else {
          // Create new record (POST). If id is present in body, backend will try to use it.
          res = await fetch(API_BASE, {
            method: 'POST',
            headers: {'Content-Type':'application/json'},
            body: JSON.stringify(body)
          });
        }

        if(!res.ok){
          // try to get error body
          let errText;
          try { errText = await res.text(); } catch(e){ errText = res.status; }
          throw new Error(errText || res.status);
        }
        await res.json(); // ignore returned object; refresh list
        resetForm();
        loadEmployees();
      }catch(err){
        alert('Save error: ' + err);
      }
      return false;
    }

    function onEdit(id){
      fetch(`${API_BASE}/${id}`).then(r=>{
        if(!r.ok) throw new Error('Failed to load employee');
        return r.json();
      }).then(emp=>{
        document.getElementById('empId').value = emp.id ?? '';
        document.getElementById('email').value = emp.email ?? '';
        document.getElementById('firstname').value = emp.firstname ?? '';
        document.getElementById('lastname').value = emp.lastname ?? '';
        // make id read-only during edit to avoid accidental PK change
        document.getElementById('empId').readOnly = true;
        document.getElementById('cancelBtn').classList.remove('hidden');
        window.scrollTo({top:0,behavior:'smooth'});
      }).catch(e=>alert('Could not load employee: '+e));
    }

    async function onDelete(id){
      if(!confirm('Delete employee id ' + id + '?')) return;
      try {
        const res = await fetch(`${API_BASE}/${id}`, { method: 'DELETE' });
        if(!res.ok) {
          const err = await res.text();
          throw new Error(err || res.status);
        }
        loadEmployees();
      } catch(err) {
        alert('Delete failed: ' + err);
      }
    }

    function resetForm(){
      document.getElementById('empId').value = '';
      document.getElementById('empId').readOnly = false;
      document.getElementById('email').value = '';
      document.getElementById('firstname').value = '';
      document.getElementById('lastname').value = '';
      document.getElementById('cancelBtn').classList.add('hidden');
    }

    // load when page opens
    loadEmployees();
  </script>
  <div class="small">Notes: If you provide an ID that already exists, the server/database will return an error (duplicate key). If the DB still has AUTO_INCREMENT enabled and you supply explicit IDs, make sure to reset AUTO_INCREMENT to a value greater than the current max id to avoid collisions.</div>
</body>
</html>
